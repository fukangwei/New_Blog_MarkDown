---
title: 可变参数传递
categories: C语言语法详解
abbrlink: 990eccd3
date: 2018-12-10 20:15:52
---
&emsp;&emsp;在编程中，需要在可变参函数中将可变参数传递给另外的函数调用，于是写出了如下代码：

``` cpp
void vTestFun_1 ( const char* fmt, ... ) {
    ...
    vTestFun_2 ( fmt, ... );
    ...
}

void vTestFun_2 ( const char* fmt, ... ) {
    /* TODO */
}
```

然而编译器告诉我不能这么用。新的代码如下：

``` cpp
void vTestFun_1 ( const char* fmt, va_list argp ) {
    /* TODO */
}

void vTestFun_2 ( const char* fmt, ... ) {
    va_list args;
    va_start ( args, fmt );
    ...
    vTestFun_1 ( fmt, args );
    ...
    va_end ( args );
}
```

后来看`Log4cpp`源码时，发现其中也有类似的函数调用：

``` cpp
void Category::_logUnconditionally ( Priority::Value priority, const char* format, va_list arguments ) throw() {
    _logUnconditionally2 ( priority, StringUtil::vform ( format, arguments ) );
}

void Category::log ( Priority::Value priority, const char* stringFormat, ... ) throw() {
    if ( isPriorityEnabled ( priority ) ) {
        va_list va;
        va_start ( va, stringFormat );
        _logUnconditionally ( priority, stringFormat, va );
        va_end ( va );
    }
}
```