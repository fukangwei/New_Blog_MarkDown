---
title: 二进制流和文本流区别
categories: C语言语法详解
abbrlink: f1d31bf1
date: 2018-12-12 05:23:20
---
&emsp;&emsp;`C`语言引入了流`stream`的概念，它将数据的输入输出看作是数据的流入和流出，这样不管是磁盘文件或者是物理设备(打印机、显示器、键盘等)，都可看作一种流的源和目的，对它们的操作就是数据的流入和流出。这种把数据的输入输出操作对象抽象化为一种流，而不管它的具体结构的方法很有利于编程，而涉及流的输出操作函数可用于各种对象，与其具体的实体无关，即具有通用性。
&emsp;&emsp;`C`语言中的流可分为两大类，即文本流`text stream`和二进制流`binarystream`。所谓文本流，是指在流中流动的数据是以字符形式出现。在文本流中，`\n`被换成回车`CR`和换行`LF`的代码`0DH`和`0AH`。而当输出时，则`0DH`和`0AH`被换成`\n`。二进制流是指流动的是二进制数字序列，若流中有字符，则用一个字节的二进制`ASCII码`表示；若是数字，则用一个字节的二进制数表示。在二进制流入流出时，对`\n`符号不进行变换。
&emsp;&emsp;例如`2001`这个数，在文本流中用其`ASCII`码表示为：

``` bash
'2' '0' '0' '1'
 |   |   |   |
50  48  48  49
```

一共占用`4`字节。而在二进制流中则表示为`00000111_11010001`，用十六进制表示就是`07D1`，只占用`2`字节。
&emsp;&emsp;由此看出，二进制流比文本流节省空间，且不用进行对`\n`的转换，这样可以大大加快流的速度，提高效率。因而对于含有大量数字信息的数字流，可以采用二进制流的方式；对于含有大量字符信息的流，则采用文本流的方式。

### 文本文件与二进制文件的定义

&emsp;&emsp;大家都知道计算机的存储在物理上是二进制的，所以文本文件与二进制文件的区别并不是物理上的，而是逻辑上的。这两者只是在编码层次上有差异。简单来说，文本文件是基于字符编码的文件，常见的编码有`ASCII`码、`UNICODE`码等。二进制文件是基于值编码的文件，你可以根据具体应用，指定某个值是什么意思(这样一个过程，可以看作是自定义编码)。
&emsp;&emsp;从上面可以看出，文本文件基本上是定长编码的(也有非定长的编码如`UTF-8`)。它基于字符编码，每个字符在具体编码中是固定的，`ASCII`码是`8`个比特的编码，`UNICODE`一般占`16`个比特。而二进制文件可看成是变长编码的，因为是基于值编码，多少个比特代表一个值，完全由你决定。大家可能对`BMP`文件比较熟悉，其头部是较为固定长度的文件头信息，前`2`字节用来记录文件为`BMP`格式，接下来的`8`个字节用来记录文件长度，再接下来的`4`字节用来记录`bmp`文件头的长度。大家可以看出来，其编码是基于值的(不定长的，`2`、`4`、`8`字节长的值都有)，所以`BMP`是二进制文件。

### 文本文件与二进制文件的存取

&emsp;&emsp;文本工具打开一个文件的过程是怎样的呢？拿记事本来说，它首先读取文件物理上所对应的二进制比特流(前面已经说了，存储都是二进制的)，然后按照你所选择的解码方式来解释这个流，然后将解释结果显示出来。一般来说，你选取的解码方式会是`ASCII`码形式(`ASCII`码的一个字符是`8`个比特)，接下来，它会按照每`8`个比特地来解释这个文件流。例如，对于这样一个文件流`01000000_01000001_01000010_01000011`，第一个`8`比特`01000000`按`ASCII`码来解码的话，所对应的字符是字符`A`，同理其它`3`个`8`比特可分别解码为`BCD`，即这个文件流可解释成`ABCD`，然后记事本就将`ABCD`显示在屏幕上。
&emsp;&emsp;事实上，世界上任何东西要与其他东西通信会话，都存在一个既定的协议。人与人之间通过文字联络，汉字`妈`代表生你的那个人，这就是一种既定的编码。但注意到这样一种情况，汉字`妈`在日本文字里有可能是你生下的那个人，所以当一个中国人`A`与日本人`B`之间用`妈`这个字进行交流，出现误解就很正常了。用记事本打开二进制文件与上面的情况类似。记事本无论打开什么文件都按既定的字符编码工作(如`ASCII`码)，所以当它打开二进制文件时，出现乱码也是很正常的。例如文件流`00000000_00000000_00000000_00000001`可能在二进制文件中对应的是一个`4`字节的整数`1`，在记事本里解释就变成了`NULL_NULL_NULL_SOH`这四个控制符。
&emsp;&emsp;文本文件的存储与其读取基本上是个逆过程，不再累述。而二进制文件的存取显然与文本文件的存取差不多，只是编/解码方式不同而已，也不再叙述。

### 文本文件与二进制文件的优缺点

&emsp;&emsp;因为文本文件与二进制文件的区别仅仅是编码上不同，所以它们的优缺点就是编码的优缺点。一般认为，文本文件编码基于字符定长，译码容易一些；二进制文件编码是变长的，所以它灵活，存储利用率要高些，译码难一些(不同的二进制文件格式有不同的译码方式)。
&emsp;&emsp;很多书上还认为，文本文件的可读性要好些，存储要花费转换时间(读写要编译码)；而二进制文件可读性差，存储不存在转换时间(读写不要编解码，直接写值)。这里的可读性是从软件使用者角度来说的，因为我们用通用的记事本工具就几乎可以浏览所有文本文件，所以说文本文件可读性好；而读写一个具体的二进制文件需要一个具体的文件解码器，所以说二进制文件可读性差，比如读`BMP`文件必须用读图软件。而这里的存储转换时间应该是从编程的角度来说的，因为有些操作系统如`Windows`需要对回车换行符进行转换(将`\n`换成`\r\n`，所以文件读写时，操作系统需要一个一个地字符的检查当前字符是不是`\n`或`\r\n`)。这个存储转换在`Linux`操作系统中并不需要，当然在两个不同的操作系统上共享文件时，这种存储转换有可能出现(如`Linux`系统和`Windows`系统共享文本文件)。

### C语言的文本读写和二进制读写

&emsp;&emsp;应该说`C`语言的文本读写与二进制的读写是一个编程层次上的问题，与具体的操作系统有关，所以`用文本方式读写的文件一定是文本文件，用二进制读写的文件一定是二进制文件`这类观点是`错误的`。下面的讲述非明确指出操作系统类型，都暗指`Windows`。
&emsp;&emsp;`C`语言的文本方读写与二进制读写的差别仅仅体现在回车换行符的处理上。文本方式写时，每遇到一个`\n`(`0AH`，即换行符)，它将其换成`\r\n`(`0D0AH`，即回车换行)，然后再写入文件；当文本读取时，它每遇到一个`\r\n`将其反变化为`\n`，然后送到读缓冲区。正因为文本方式有`\n`到`\r\n`之间的转换，其转换需要耗时。二进制读写时，其不需要任何转换，直接将写缓冲区中数据写入文件。
&emsp;&emsp;总的来说，从编程的角度来说，`C`语言中文本或二进制读写都是缓冲区与文件中二进制流的交互，只是文本读写时有回车换行的转换。所以当写缓冲区中无换行符`\n`(`0AH`)时，文本写与二进制写的结果是一样的；同理，当文件中不存在`\r\n`(`0DH0AH`)时，文本读与二进制读的结果是一样的。