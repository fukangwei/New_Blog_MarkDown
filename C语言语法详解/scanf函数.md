---
title: scanf函数
date: 2018-12-12 13:29:39
categories: C语言语法详解
---
&emsp;&emsp;该博客主要来源于[scanf](https://baike.baidu.com/item/scanf/10773316)，内容经过测试和修改，感谢原作者。
&emsp;&emsp;scanf是C语言中的一个输入函数，与printf函数一样，都被声明在头文件`stdio.h`里。它是格式输入函数，即按用户指定的格式从键盘上把数据输入到指定的变量之中。函数原型如下所示：

``` c
int scanf ( const char* restrict format, ... );
```

函数scanf是从标准输入流stdio(标准输入设备，一般指向键盘)中读内容的通用子程序，用说明的格式读入多个字符，并保存在对应地址的变量中。函数的第一个参数是格式字符串，它指定了输入的格式，并按照格式说明符解析输入对应位置的信息，并存储于可变参数列表中对应的指针所指位置。每一个指针要求非空，并且与字符串中的格式符一一顺次对应。若函数执行成功，则返回读入的数据项数；读到文件末尾或出错时则返回EOF。

``` c
scanf ( "%d %d", &a, &b );
```

如果a和b都被成功读入，那么scanf的返回值就是2；如果只有a被成功读入，返回值为1；如果a和b都未被成功读入，返回值为0；如果遇到错误或遇到`end of file`，返回值为EOF。使用scanf函数输入数据：

``` c
#include <stdio.h>

int main ( void ) {
    int a, b, c;
    printf ( "Give me the value of a,b,c seperated with whitespaces:\n" );
    scanf ( "%d%d%d", &a, &b, &c );
    printf ( "a = %d, b = %d, c = %d\n", a, b, c );
    return 0;
}
```

`&a, &b, &c`中的`&`是寻址操作符，`&a`表示对象a在内存中的地址，是一个右值。变量a、b、c的地址是在编译阶段分配的(存储顺序由编译器决定)。需要注意，如果scanf中`%d`是连着写的(如`%d%d%d`)，在输入数据时，数据之间不可以用逗号分隔，只能用空白字符(空格或tab键或者回车键)分隔：`2(空格)3(tab)4`或`2(tab)3(回车)4`等。若是`%d,%d,%d`，则在输入数据时需要加`,`，如`2,3,4`。

### 格式指令说明

&emsp;&emsp;format指向的字符串包含的格式指令由以下字符序列组成：  
&emsp;&emsp;1. `*`：表示读入的数据将被舍弃。带有`*`的格式指令不对应可变参数列表中的任何数据。  
&emsp;&emsp;2. `域宽`：以一个非零的十进制整数形式出现，表示该格式指令最多读入的字符数。  
&emsp;&emsp;3. `格式说明符`：如下所示，无效的转换说明符将引起未定义的行为：

- `c`：读入域宽指定的数目个字符组成的字符序列(后面不会加上空字节)，如果省略宽度则读入单字符。如`%c`或`%1c`读入单字符，`%2c`读入两个字符(后面不会加上空字节)，以此类推。
- `s`：读入一个的字符序列，后面会加上空字节。
- `d`：读入可选有符号(可选有符号表示输入时可以带符号也可以不带符号，不带符号则视为非负)十进制整数。输入格式应该像`strtol`函数的base实参为10调用时识别的字符序列一样。
- `i`：读入可选有符号整数。输入格式应该像`strtol`函数的base实参为0调用时识别的字符序列一样。
- `a、e、f、g、A、E、F、G`：读入可选有符号浮点数，输入格式应该像`strtod`函数识别的字符序列一样。
- `o`：读入可选有符号八进制整数。输入格式应该像`strtoul`函数的base实参为8调用时识别的字符序列一样。
- `x、X`：读入可选有符号十六进制整数。输入格式应该像`strtoul`函数的base实参为16调用时识别的字符序列一样。
- `p`：读入一个指针值。读入的字符序列应该与`fprintf`的`%p`产生的字符序列形式相同。
- `n`：不读入任何字符，而是把到该位置已读入的字符数存储到与之对应的`int *`指向的位置。本转换说明符如果带有`*`或者带有域宽信息(如`%*n`或`%3n`等)，则后果是未定义的。
- `u`：读入可选有符号八进制整数。输入格式应该像`strtoul`函数的base实参为10调用时识别的字符序列一样。
- `[`：扫描字符集合。
- `%`：读入`%`符号(百分号)。

&emsp;&emsp;4. `长度修饰符`：如下所示，如果长度修饰符与格式说明符不匹配则引起未定义的行为：

- `hh`与`d、i、o、u、x、X、n`配合使用，表示对应一个`signed char`或`unsigned char`数据。
- `h`与`d、i、o、u、x、X、n`配合使用，表示对应一个`short int`或`unsigned short int`数据。
- `l`与`d、i、o、u、x、X、n`配合使用，表示对应一个`long int`或`unsigned long int`数据；与`a, A, e, E, f, F, g, or G`配合使用表示对应一个double数据；与`c、s、[`配合使用表示对应`wchar_t`数据。
- `ll`与`d、i、o、u、x、X、n`配合使用，表示对应一个`long long int`或`unsigned long long int`数据。
- `j`与`d、i、o、u、x、X、n`配合使用，表示对应一个`intmax_t`或`uintmax_t`数据。
- `z`与`d、i、o、u、x、X、n`配合使用，表示对应一个`size_t`数据(或与`size_t`对应的有符号整型数据)。
- `t`与`d、i、o、u、x、X、n`配合使用，表示对应一个`ptrdiff_t`数据(或与`ptrdiff_t`对应的无符号整型数据)。
- `L`与`a、A、e、E、f、F、g、G`配合使用，表示对应一个`long double`数据。

#### 空白字符和非空白字符

- 空白字符：空白字符会使scanf函数在读操作中略去输入中的一个或多个空白字符。
- 非空白字符：一个非空白字符会使scanf函数在读入时剔除掉与这个非空白字符相同的字符。

&emsp;&emsp;具体说明如下所示：

- `%s`表示读字符串，而`%d`表示读整数。格式串的处理顺序为从左到右，格式说明符逐一与变元表中的变元匹配。为了读取长整数，可以将`L/l`放在格式说明符的前面；为了读取短整数，可以将`h`放在格式说明符的前面。这些修饰符可以与`d、i、o、u`和`x`格式代码一起使用。
- 默认情况下，`a、f、e`和`g`告诉scanf为float分配数据。如果将`L/l`放在这些修饰符的前面，则scanf为double分配数据。使用L就是告诉scanf，接收数据的变量是`long double`型变量。
- 控制串中的空白符使scanf在输入流中跳过一个或多个空白行。空白符可以是空格(space)、制表符(tab)和新行符(newline)。 本质上，控制串中的空白符使scanf在输入流中读，但不保存结果，直到发现非空白字符为止。
- 非空白符使scanf在流中读一个匹配的字符并忽略之。例如，`%d,%d`使scanf先读入一个整数，读入中放弃逗号，然后读另一个整数；如未发现匹配，scanf返回。
- scanf中用于保存读入值的变元必须都是变量指针，即相应变量的地址。
- 在输入流中，数据项必须由空格、制表符和新行符分割。逗号和分号等不是分隔符，比如`scanf("%d%d", &r, &c);`将接受输入`10 20`，但遇到`10,20`则失败。
- 百分号`%`与格式符之间的星号`*`表示读指定类型的数据但不保存。因此`scanf("%d%*c%d", &x, &y);`对`10/20`的读入操作中，10放入变量`x`，20放入`y`。
- 格式命令可以说明最大域宽。在百分号`%`与格式码之间的整数用于限制从对应域读入的最大字符数。例如，希望向address读入不多于20个字符时，可以书写成如下形式`scanf("%20s", &address);`。如果输入流的内容多于20个字符，则下次scanf从此次停止处开始读入。若达到最大域宽前已遇到空白符，则对该域的读立即停止；此时，scanf跳到下一个域。
- 虽然空格、制表符和新行符都用做域分割符号，但读单字符操作中却按一般字符处理。例如，对输入流`x y`调用`scanf("%c%c%c", &a, &b, &c);`返回后，x在变量a中，空格在变量b中，y在变量c中。注意控制串中的其它字符，包括空格、制表符和新行符，都用于从输入流中匹配并放弃字符，被匹配的字符都放弃。例如，给定输入流`10t20`，调用`scanf("%dt%d", &x, &y);`后，将把10和20分别放到x和y中，t被放弃，因为t在控制串中。
- `ANSI C`标准向scanf增加了一种新特性，称为扫描集(scanset)。扫描集定义一个字符集合，可由scanf读入其中允许的字符并赋给对应字符数组。扫描集合由一对方括号中的一串字符定义，左方括号前必须缀以百分号。例如，以下的扫描集使scanf读入字符A、B和C：

``` c
%[ABC]
```

使用扫描集时，scanf连续吃进集合中的字符并放入对应的字符数组，直到发现不在集合中的字符为止(即扫描集仅读匹配的字符)。返回时，数组中放置以null结尾、由读入字符组成的字符串。用字符`^`可以说明补集，把`^`字符放为扫描集的第一字符时，构成其它字符组成的命令的补集合，指示scanf只接受未说明的其它字符。对于许多实现来说，用连字符可以说明一个范围(`ISO C99`标准没有规定)。例如，以下扫描集使scanf接受字母A到Z：

``` c
%[A-Z]
```

重要的是要注意扫描集是区分大小写的。因此，希望扫描大、小写字符时，应该分别说明大、小写字母。

- scanf返回等于成功赋值的域数的值，但由于星号修饰符而读入未赋值的域不计算在内；遇到文件结束则返回EOF；若出错则返回0。

### 注意问题

- 对于字符串数组或字符串指针变量，由于数组名可以转换为数组和指针变量名本身就是地址，因此使用scanf函数时，不需要在它们前面加上`&`操作符。
- 可以在格式化字符串中的`%`各格式化规定符之间加入一个整数，表示任何读操作中的最大位数。
- scanf函数中没有类似printf的精度控制。如`scanf("%5.2f", &a);`是非法的，不能企图用此语句输入小数为2位的实数。
- scanf中要求给出变量地址，如给出变量名则会出错。如`scanf("%d", a);`是非法的，应改为`scanf("%d", &a);`。
- 在输入多个数值数据时，若格式控制串中没有非格式字符作输入数据之间的间隔，则可用空格、TAB或回车作间隔。C编译在碰到空格、TAB、回车或非法数据(如对`%d`输入`12A`时，A即为非法数据)时即认为该数据结束。
- 在输入字符数据`%c`时，若格式控制串中无非格式字符，则认为所有输入的字符均为有效字符。例如`scanf("%c%c%c", &a, &b, &c);`，输入为`d e f`时，则把`d`赋予a，空格赋予b，`e`赋予c。因为`%c`只要求读入一个字符，后面不需要用空格作为两个字符的间隔，因此把空格作为下一个字符送给b。只有当输入为`def`，字符间无空格时，才能把`d`赋于a，`e`赋予b，`f`赋予c。如果在格式控制中加入空格作为间隔，如`scanf("%c %c %c", &a, &b, &c);`时，则输入时各数据之间可加空格。

&emsp;&emsp;如何让scanf函数正确接受有空格的字符串？如输入`I love you!`。如果使用`char str[80]; scanf("%s", str);`，只能输出`I`，因为scanf扫描到`I`后面的空格就认为对str的扫描结束(空格没有被扫描)，并忽略后面的`(空格)love you!`。残留的信息`(空格)love you`是存在于stdin流中，而不是在键盘缓冲区中。那么scanf函数能不能完成这个任务？回答是`能`！别忘了scanf函数还有一个`%[]`格式控制符，请看下面的程序：

``` c
#include <stdio.h>

int main ( void ) {
    char str[50];
    scanf ( "%[^\n]", str ); /* “scanf( "%s", string );”不能接收空格符 */
    printf ( "%s\n", str );
    return 0;
}
```