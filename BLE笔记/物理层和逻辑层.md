---
title: 物理层和逻辑层
date: 2020-11-07 08:05:42
categories: BLE笔记
mathjax: true
---
### Physical Layer(物理层)

&emsp;&emsp;`Physical Layer`负责提供数据传输的物理信道。蓝牙的物理层分为`Physical Channel`和`Physical Links`两个子层。<!--more-->

#### Physical Channel(物理信道)

&emsp;&emsp;`BLE`使用`2.4 GHz ISM`频段，频率范围是`2.400`至`2.4835 GHz`。`ISM`频率范围内被分成`40`个`channel`，每一个`channel`占用`2M`的带宽，称作`RF Channel`：

$$
F = 2402 + k * 2MHz, k = 0, \cdots , 39
$$

&emsp;&emsp;`BLE`的通信采用了跳频技术(`Hopping`)，也就是说，某一个物理信道并不是固定地占用`40`个`channel`中的某一个，而是以一定的规律在跳动。因此蓝牙的物理信道也被称作`跳频信道`(`Hopping Channel`)。
&emsp;&emsp;`LE`技术定义了`2`种物理信道：`LE Piconet Channel`和`LE Advertisement Broadcast Channel`：

- `LE Piconet Channel`用在处于连接状态的蓝牙设备之间的通信，它只会在`40`个频率`channel`中的`37`个上面跳频(注意，广播信道为`37`、`38`和`39`)。
- `LE Advertisement Broadcast Channel`用于在设备间进行无连接的广播通信，这些广播通信可用于蓝牙设备的发现、连接操作，也可用于无连接的数据传输。

信道类型                         | 信道号          | 描述
--------------------------------|-----------------|------
`Primary Advertising Channel`   | `37`、`38`、`39` | 发送传统广播和扫描请求
`Secondary Advertising Channel` | `0-36`           | 发送拓展广播
`Periodic Advertising Channel`  | `0-36`           | 发送周期广播
`Data Channel`                  | `0-36`           | 发送连接数据

#### Physical Links(物理链路)

&emsp;&emsp;物理链路是对这些物理信道的进一步封装，它是一个虚拟概念，不对应协议中任何的实体。

### 逻辑层(Logical Layer)

&emsp;&emsp;逻辑层的主要功能：在已连接的蓝牙设备之间，基于物理链路建立逻辑信道(`Logical Channel`)。
&emsp;&emsp;所谓的逻辑信道，和城市道路上的车道类似：一条城市道路可以看做一个物理链路，该物理链路根据行车用途，可以划分为多个逻辑信道，例如直行车道、右转车道、快速车道等。
&emsp;&emsp;这里的车道(`Logical Channel`)从物理角度看，并没有什么分别，只是为了方便交通(数据传输)，人为地抽象出来的。和车道类似，蓝牙逻辑信道的划分依据是传输类型，主要包括下面`3`类：

- 用于管理底层物理链路的控制类传输，包括`AMP-C`、`ACL-C`、`PSB-C`、`LE-C`、`ADVB-C`。
- 传输用户数据的用户类传输，包括`AMP-U`、`ACL-U`、`PSB-U`、`LE-U`、`ADVB-U`。
- 其它比较特殊的传输类型，包括流式传输(`Stream`)、`PBD`(`Profile Broadcast Data`)。

&emsp;&emsp;以上每种`Logic Link`都会在下层对应一个`Logical Transport`，这些`Logical Transport`具有一些属性值，例如`流控`、`应答/重传`机制等。