---
title: CC2530应用总结
categories: CC2530和zigbee笔记
date: 2019-02-05 13:33:57
---
### zigbee使用注意事项

&emsp;&emsp;`zigbee`的注意事项如下：<!--more-->

1. 注意`zigbee`中协调器的供电，否则通讯网络就无法建立。
2. 对`zigbee`开发板下载代码时，首先要对下载器进行复位。
3. `zigbee`的协调器和路由器需要进行持续供电，而终端节点不需要。
4. `zigbee`的路由器具备路由功能，而终端节点不具备。
5. `zigbee`协议栈的端口`0`保留给`ZDO`(设备对象层)的数据接口，端口`255`用于向所有应用任务广播数据。
6. `zigbee`协议栈中有内存管理和字符串管理函数，最好使用`zigbee`提供的函数。
7. `tasksArr`数组里各事件处理函数的排列顺序要与`osalInitTasks`函数中调用各任务初始化函数的顺序保持一致，只有这样才能保证每个任务的事件处理函数能够接收到正确的任务`ID`(在`osalInitTasks`函数中分配)。

### CC2530内置温度传感器温度计算方法

&emsp;&emsp;如果`ADC`采用`12`位方式，工作电压`3V`，使用内部基准`1.25V`，温度传感器有如下规律：`25`摄氏度时，`AD`读数为`1480`；温度变化`1`度，`AD`采集值变化`4.5`(`CC2530`数据手册有误，写成温度变化`10`摄氏度`AD`采集值变化`4.5`；另外`demosensor`代码认为温度变化`1`摄氏度，`AD`采集值变化`4.0`，这两个地方都是有误的)。
&emsp;&emsp;了解上述规律，温度计算就可以用这个公式来计算：

``` cpp
实际温度 = ( AD读数 - ( 1480 - 4.5 * 25 ) ) / 4.5 = ( AD读数 - 1367.5 ) / 4.5
```

### CC2530的P0IFG与P0IF

&emsp;&emsp;为什么有了`P0IFG`，怎么又需要操作`P0IF`？`P0IF`是`IRCON`中的一位，用于表示`P0`口有中断，但具体是哪一个由`P0IFG`来判断，所以`IO`口中断处理函数的一般写法是：

``` cpp
HAL_ISR_FUNCTION ( port0_ISR, P0INT_VECTOR ) {
    register uint8 i;
    P0IF = 0;

    if ( P0IFG ) {
        for ( i = 0; i < 8; i++ ) {
            register const uint8 pinmask = 1 << i;

            if ( P0IFG & pinmask ) {
                if ( port0_isr_tbl[i] != 0 ) {
                    ( *port0_isr_tbl[i] ) ();
                }

                P0IFG &= ~pinmask;
            }
        }

        /* __low_power_mode_off_on_exit(); */
    }
}
```

### PERCFG的备用位置

&emsp;&emsp;具体情况要参考`CC253x`用户手册的外设`I/O`引脚映射表格。对于外设，定时器和`USART`在`I/O`端口中有对应的位置。比如`USART1`，当使用`UART`模式的备用位置`1`时，使用的是`P0.4`和`P0.5`端口来实现接收和发送数据，`P0.4`对应`TX`，`P0.5`对应`RX`；备用位置`2`使用的是`P1.6`和`P1.7`端口，其中`P1.6`对应`TX`，`P1.7`对应`RX`。

### CC2530的printf重定向

&emsp;&emsp;`CC2530`在`IAR`下的`printf`重定向的方法和`8051`是一致的。第一步是包含头文件`stdio.h`，第二步是定义`putchar`函数：

``` cpp
__near_func int putchar ( int c ) {
    UTX0IF = 0;
    U0DBUF = ( char ) c;
    while ( UTX0IF == 0 );
    return ( c );
}
```

到这里所有工作都完成了。在使用时，一定要注意串口的初始化，尤其要注意`CC2530`当前使用的晶振频率，否则会打印出乱码。当需要串口`1`实现这样的功能时，需要对上述代码进行相应修改。