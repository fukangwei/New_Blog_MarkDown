---
title: PWM电机调速原理
categories: 硬件电路笔记
abbrlink: d9c1f0ea
date: 2018-12-03 18:38:37
---
&emsp;&emsp;对于电机的转速调整，我们是采用脉宽调制(`PWM`)办法。控制电机的时候，电源并非连续地向电机供电，而是在一个特定的频率下以方波脉冲的形式提供电能。不同占空比的方波信号能对电机起到调速作用，这是因为电机实际上是一个大电感，它有阻碍输入电流和电压突变的能力，因此脉冲输入信号被平均分配到作用时间上。这样，改变在始能端`PE2`和`PD5`上输入方波的占空比就能改变加在电机两端的电压大小，从而改变了转速。
&emsp;&emsp;此电路中用微处理机来实现脉宽调制，通常的方法有两种：

- 用软件方式来实现，即通过执行软件延时循环程序交替改变端口某个二进制位输出逻辑状态来产生脉宽调制信号，设置不同的延时时间得到不同的占空比。
- 硬件实现自动产生`PWM`信号，不占用`CPU`处理的时间。这就要用到`ATMEGA8515L`的在`PWM`模式下的计数器`1`。

### 51单片机PWM程序

&emsp;&emsp;产生两个`PWM`，要求两个`PWM`波形占空比都为`80/256`，两个波形之间要错开，不能同时为高电平，高电平之间相差`48/256`。`PWM`这个功能在`PIC`单片机上就有，但是如果使用`51`单片机的话，也是可以的，但是比较麻烦。可以用定时器`T0`来控制频率，定时器`T1`来控制占空比。大致的的编程思路是这样的：`T0`定时器中断是让一个`IO`口输出高电平，在这个定时器`T0`的中断当中启动定时器`T1`，而这个`T1`是让`IO`口输出低电平，这样改变定时器`T0`的初值就可以改变频率，改变定时器`T1`的初值就可以改变占空比。

``` cpp
// ------------------------------------------------------------------------------
// 程序思路说明：关于频率和占空比的确定，对于12M晶振，假定PWM输出频率为1KHz，这样定时中断次数
// 设定为“C = 10”，即0.01Ms中断一次，则“TH0 = FF”，“TL0 = F6”。由于设定中断时间为0.01ms，
// 这样可以设定占空比可从1至100变化，即“0.01ms * 100 = 1ms”。
// ------------------------------------------------------------------------------
#include <REGX51.H>

#define uchar unsigned char

// -------------------------------------------------------------------
// TH0和TL0是计数器0的高8位和低8位计数器，计算办法是“TL0 = (65536-C) % 256”，
// “TH0 = (65536-C)/256”，其中C为所要计数的次数即多长时间产生一次中断。TMOD是
// 计数器工作模式选择，0X01表示选用模式1，它有16位计数器，最大计数脉冲为65536，
// 最长时间为“1ms * 65536 = 65.536ms”。
// -------------------------------------------------------------------
#define V_TH0  0XFF
#define V_TL0  0XF6
#define V_TMOD 0X01

unsigned char ZKB1, ZKB2;

void init_sys ( void );
void Delay5Ms ( void );

void main ( void ) {
    init_sys();
    ZKB1 = 40; /* 占空比初始值设定 */
    ZKB2 = 70; /* 占空比初始值设定 */

    while ( 1 ) {
        if ( !P1_1 ) { /* 如果按了“+”键，则增加占空比 */
            Delay5Ms();

            if ( !P1_1 ) {
                ZKB1++;
                ZKB2 = 100 - ZKB1;
            }
        }

        if ( !P1_2 ) { /* 如果按了“-”键，减少占空比 */
            Delay5Ms();

            if ( !P1_2 ) {
                ZKB1--;
                ZKB2 = 100 - ZKB1;
            }
        }

        /* 对占空比值限定范围 */
        if ( ZKB1 > 99 ) {
            ZKB1 = 1;
        }

        if ( ZKB1 < 1 ) {
            ZKB1 = 99;
        }
    }
}

void init_sys ( void ) { /* 对系统进行初始化，包括定时器初始化和变量初始化 */
    TMOD = V_TMOD;
    TH0 = V_TH0;
    TL0 = V_TL0;
    TR0 = 1;
    ET0 = 1;
    EA = 1;
}

void Delay5Ms ( void ) {
    unsigned int TempCyc = 1000;

    while ( TempCyc-- );
}

void timer0 ( void ) interrupt 1 using 2 {
    static uchar click = 0; /* 中断次数计数器变量 */
    TH0 = V_TH0; /* 恢复定时器初始值 */
    TL0 = V_TL0;
    ++click;

    if ( click >= 100 ) {
        click = 0;
    }

    /* 当小于占空比值时输出低电平，高于时是高电平，从而实现占空比的调整 */
    if ( click <= ZKB1 ) {
        P1_3 = 0;
    } else {
        P1_3 = 1;
    }

    if ( click <= ZKB2 ) {
        P1_4 = 0;
    } else {
        P1_4 = 1;
    }
}
```