---
title: 获取文件大小
date: 2018-12-30 16:02:56
categories: C语言应用代码
---
&emsp;&emsp;`C`语言是一种比较底层的语言，有时在其他语言中很容易操作的事情，在`C`语言中就比较麻烦。例如获取一个文件的大小，`Java`中`File`类有个`length`函数，`Python`中`os.path`包中有个`getsize`函数，`C`语言中却没有直接对应的函数获取文件大小。目前网上有一种流传很广的方法，读取文件到内存，然后跳转到文件末尾，查看跳转的长度：

``` cpp
int file_size ( char *filename ) {
    FILE *fp = fopen ( filename, "r" );
​
    if ( !fp ) {
        return -1;
    }
​
    fseek ( fp, 0L, SEEK_END );
    int size = ftell ( fp );
    fclose ( fp );
    return size;
}
```

上述方法利用`fseek`移动一个文件的存取位置到文件的末尾，然后利用`ftell`获得目前的文件访问位置。这种方法可以认为是一种间接的获取方式。虽说可以获得文件大小，但是有两个缺点。首先，`ftell`的返回值为`long`，在不同环境下占用的字节数也不同，这就可能存在`long`是四个字节的情况。此时，获取的文件大小就不能超过`2G`，否则就会出错。
&emsp;&emsp;上述缺点在大多数情况下都没问题，超大文件还可以通过`fsetpos`和`fgetpos`获取文件大小。最致命的缺陷就是它需要加载文件到内存，然后跳转到文件末尾，这个操作非常耗时。
&emsp;&emsp;如果可能的话，尽量避免采用上述间接的方式获取文件大小。在`linux`下，还有一种更简单的方式，通过读取文件信息获得文件大小，速度也快很多：

``` c
#include <sys/stat.h>

int file_size ( char* filename ) {
    struct stat statbuf;
    stat ( filename, &statbuf );
    int size = statbuf.st_size;
    return size;
}
```

&emsp;&emsp;**补充说明**：在使用文件指针取得文件的大小后，一定不要忘记将其转移到最初的位置。