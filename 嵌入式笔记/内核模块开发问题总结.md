---
title: 内核模块开发问题总结
date: 2019-01-17 18:06:51
categories: 嵌入式笔记
---
### rmmod：No such file or directory

&emsp;&emsp;在卸载内核模块时常常遇到`rmmod: No such file or directory`这个错误，原因是没将内核模块放在文件系统指定的目录内。在配置内核时，`General setup -->`选项下有一个`()Local version - append to kernel release`。若不填这个括号，在编译完内核模块并执行`make module_install ARCH=arm INSTALL_MOD_PATH=/XXX(根文件系统所在目录)`后，内核模块所在目录为`/lib/modules/2.6.XX`。所以只要将编译的内核模块放到该目录下，再执行`rmmod`时才不会报出`rmmod: No such file or directory`这个错误。
&emsp;&emsp;若括号内填入了`abcd`，则内核模块所在目录为`/lib/modules/2.6.XX-abcd`。

### TASK_INTERRUPTIBLE undeclared

&emsp;&emsp;原因是缺少头文件`linux/sched.h`，添加后即可通过编译。

### struct_device has no member named bus_id

&emsp;&emsp;在新版本的内核中，`struct device`已经没有`bus_id`成员，取而代之的是通过`dev_name`和`dev_set_name`对设备的名字进行操作。以后只要使用`dev->bus_id`时，改成`dev_name(dev)`就可以了。

### modprobe FATAL module xxx not found

&emsp;&emsp;若加载的模块是`hello.ko`，应该先`depmod hello.ko`，然后`modprobe hello`(不是`hello.ko`)。

### include/linux/autoconf.h or include/config/auto.conf are missing

&emsp;&emsp;做了一个简单的设备驱动模块，执行`sudo make`出现如下错误：`include/linux/autoconf.h or include/config/auto.conf are missing`。解决方法是编译内核，这个内核是`ARM`的内核，因为需要在`PC`上制造出一个和`ARM`也一样的内核编译环境，也就是交叉编译环境。