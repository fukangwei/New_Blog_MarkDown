---
title: S3C2440的IO口基本操作
categories: 嵌入式笔记
abbrlink: 2762851b
date: 2019-01-18 08:57:12
---
&emsp;&emsp;`S3C2440A`包含了`130`个多功能`输入/输出`口引脚，它们分为`A`至`J`共`9`组。通过设置相应的寄存器，可以决定每个引脚的功能：输入、输出或是其他特殊功能。<!--more-->

### 操作GPIO

&emsp;&emsp;每组`GPIO`可以通过`3`个寄存器来控制与访问：

- `GPxCON`：端口配置寄存器。
- `GPxDAT`：端口数据寄存器。
- `GPxUP`：端口上拉电阻使能寄存器。

### GPxCON寄存器

&emsp;&emsp;它可以选择`GPIO`的功能，其中`PORTA`与`PORTB`至`PORTJ`在功能选择方面有所不同。`GPACON`中每一位对应一个`IO`口(共`23`个)。当某位为`0`时，相应的`IO`为输出；为`1`时，相应的引脚为地址线或用于地址控制。`PORTB`至`PORTJ`在寄存器操作方面完全相同，`GPxCON`中每两位控制一个引脚：`00`表示输入，`01`表示输出，`10`表示特殊功能，`11`保持不用。

### GPxDAT寄存器

&emsp;&emsp;用于`读/写`引脚：当引脚被设为输入时，读此寄存器可知相应引脚电平是高还是低；当引脚被设为输出时，写该寄存器相应位可令此引脚输出高电平还是低电平。

### GPxUP寄存器

&emsp;&emsp;端口上拉寄存器控制每个端口组的`使能/禁止`上拉电阻。当相应位为`0`时，使能引脚的上拉电阻；当为`1`时，禁止上拉电阻。

### LED程序设计

&emsp;&emsp;先将对应的引脚设置为输出模式，再向相应的引脚输出高电平或低电平即可。

``` c
#define rGPBCON (*(volatile unsigned *) 0x56000010) /* Port B control    */
#define rGPBDAT (*(volatile unsigned *) 0x56000014) /* Port B data       */
#define rGPBUP  (*(volatile unsigned *) 0x56000018) /* Pull-up control B */
​
#define LED1_ON  (rGPBDAT &= ~(1 << 5) ) /* GPB5位清0 */
#define LED1_OFF (rGPBDAT |=  (1 << 5) ) /* GPB5位置1 */
#define LED2_ON  (rGPBDAT &= ~(1 << 6) )
#define LED2_OFF (rGPBDAT |=  (1 << 6) )
#define LED3_ON  (rGPBDAT &= ~(1 << 7) )
#define LED3_OFF (rGPBDAT |=  (1 << 7) )
#define LED4_ON  (rGPBDAT &= ~(1 << 8) )
#define LED4_OFF (rGPBDAT |=  (1 << 8) )
​
void Delay ( void ) {
    int i;
​
    for ( i = 0; i < 1000000; i++ );
}
​
int Main ( void ) {
    /* 对GPBCON[10:17]清零 */
    rGPBCON &= ~ ( ( 3 << 10 ) | ( 3 << 12 ) | ( 3 << 14 ) | ( 3 << 16 ) );
    /* 设置GPB5至8为输出 */
    rGPBCON |= ( ( 1 << 10 ) | ( 1 << 12 ) | ( 1 << 14 ) | ( 1 << 16 ) );
    /* 设置GPB5至8的上拉功能 */
    rGPBUP &= ~ ( ( 1 << 5 ) | ( 1 << 6 ) | ( 1 << 7 ) | ( 1 << 8 ) );
    /* 关闭LED */
    rGPBDAT |= ( 1 << 5 ) | ( 1 << 6 ) | ( 1 << 7 ) | ( 1 << 8 );
​
    while ( 1 ) {
        LED1_ON;
        Delay();
        LED1_OFF;
        LED2_ON;
        Delay();
        LED2_OFF;
        LED3_ON;
        Delay();
        LED3_OFF;
        LED4_ON;
        Delay();
        LED4_OFF;
    }
​
    return 0;
}
```