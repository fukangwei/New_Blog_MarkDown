---
title: Perl格式化输出
date: 2018-12-19 07:37:30
categories: Perl
---

&emsp;&emsp;`Perl`是一个非常强大的文本数据处理语言。`Perl`可以使用`format`来定义一个模板，然后使用`write`按指定模板输出数据。`Perl`格式化定义语法格式如下：

``` perl
format FormatName =
fieldline
value_one, value_two, value_three
fieldline
value_one, value_two
.
```

- `FormatName`：格式化名称。
- `fieldline`：一个格式行，用来定义一个输出行的格式，类似于`@`、`^`、`<`、`>`、`|`这样的字符。
- `value_one`、`value_two`、`...`：数据行，用来向前面的格式行中插入值，都是`perl`的变量。
- `.`：结束符号。

``` perl
$text = "google runoob taobao";
​
format STDOUT =
first: ^<<<<<  # 左边对齐，字符长度为6
    $text
second: ^<<<<<  # 左边对齐，字符长度为6
    $text
third: ^<<<<  # 左边对齐，字符长度为5，taobao最后一个“o”被截断
    $text  
.
write
```

执行结果：

``` bash
first: google
second: runoob
third: taoba
```

&emsp;&emsp;格式行(图形行)语法：

- 格式行以`@`或者`^`开头，这些行不作任何形式的变量代换。
- `@`字段(不要同数组符号`@`相混淆)是普通的字段。
- `@`、`^`后的`<`、`>`、`|`长度决定了字段的长度，如果变量超出定义的长度，那么它将被截断。
- `<`、`>`、`|`还分别表示左对齐、右对齐和居中对齐。
- `^`字段用于多行文本块填充。

### 值域格式

&emsp;&emsp;值域的格式如下表所示：

格式                               | 值域含义
-----------------------------------|--------
`@<<<`                             |左对齐输出
`@>>>`                             | 右对齐输出
<code> @&#124;&#124;&#124; </code> | 中对齐输出
`@##.##`                           | 固定精度数字
`@*`                               | 多行文本

每个值域的第一个字符是行填充符，当使用`@`字符时，不做文本格式化。在上表中，除了多行值域`@*`，域宽都等于其指定的包含字符`@`在内的字符个数，例如`@###.##`表示七个字符宽，小数点前四个，小数点后两个。

### 格式变量

&emsp;&emsp;格式变量如下：

- `$~`、`$FORMAT_NAME`：格式名字。
- `$%`、`$FORMAT_PAGE_NUMBER`：当前输出的页号。
- `$=`、`$FORMAT_LINES_PER_PAGE`：每页中的行数。
- `$|`、`$FORMAT_AUTOFLUSH`：是否自动刷新输出缓冲区存储。

以下是一个简单使用`$~`格式化的示例：

``` perl
$~ = "MYFORMAT";  # 指定缺省文件变量下所使用的格式
write;  # 输出“$~”所指定的格式
​
format MYFORMAT =  # 定义格式MYFORMAT
=================================
      Text  # 菜鸟教程
=================================
.
write;
```

执行结果：

``` bash
=================================
      Text  # 菜鸟教程
=================================
=================================
      Text  # 菜鸟教程
=================================
```

在不指定`$~`的情况下，会输出名为`STDOUT`的格式：

``` perl
write;  # 在不指定“$~”的情况下，会寻找名为STDOUT的格式
​
format STDOUT =
~用“~”号指定的文字不会被输出
----------------
  STDOUT格式
----------------
.
```

执行结果：

``` bash
----------------
  STDOUT格式
----------------
```

### 输出到其它文件

&emsp;&emsp;默认情况下，函数`write`将结果输出到标准输出文件`STDOUT`，也可以使它将结果输出到任意其它的文件中，最简单的方法就是把文件变量作为参数传递给`write`：

``` perl
write(MYFILE);
```

以上代码`write`就用名为`MYFILE`的打印格式输出到文件`MYFILE`中：

``` perl
if ( open(MYFILE, ">tmp") ) {
    $~ = "MYFORMAT";
    # 含有文件变量的输出，此时会打印与变量同名的格式，
    # 即MYFILE。“$~”里指定的值被忽略
    write MYFILE;

    format MYFILE = # 与文件变量同名
    =================================
        输入到文件中
    =================================
    .
    close MYFILE;
}
```

执行成功后，我们可以查看`tmp`文件的内容：

``` bash
=================================
      输入到文件中
=================================
```