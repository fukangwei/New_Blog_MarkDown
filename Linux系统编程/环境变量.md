---
title: 环境变量
date: 2019-02-02 20:51:23
categories: Linux系统编程
---
### getenv

&emsp;&emsp;其函数原型如下：

``` cpp
#include <stdlib.h>
char *getenv ( const char *name );
```

`getenv`用来取得参数`name`环境变量的内容，参数`name`为环境变量的名称，如果该变量存在，则会返回指向该内容的指针。环境变量的格式为`name = value`。执行成功则返回指向该内容的指针，找不到符合的环境变量名称则返回`NULL`。

``` cpp
#include <stdlib.h>
#include <stdio.h>
​
int main() {
    char *p;
​
    if ( ( p = getenv ( "USER" ) ) ) {
        printf ( "USER = %s\n", p ); /* 输出“USER = fukangwei” */
    }
}
```

### putenv

&emsp;&emsp;其函数原型如下：

``` cpp
#include <stdlib.h>
int putenv ( const char *string );
```

`putenv`用来改变或增加环境变量的内容，参数`string`的格式为`name = value`，如果该环境变量原先存在，则变量内容会依参数`string`改变，否则此参数内容会成为新的环境变量。执行成功则返回`0`，有错误发生则返回`-1`。错误代码为`ENOMEM`，即内存不足，无法配置新的环境变量空间。

``` cpp
#include <stdio.h>
#include <stdlib.h>
​
int main() {
    char *p;
​
    if ( ( p = getenv ( "USER" ) ) ) {
        printf ( "USER = %s\n", p );
    }
​
    putenv ( "USER = test" );
    printf ( "USER = %s\n", getenv ( "USER" ) );
}
```

执行结果：

``` cpp
USER = fukangwei
USER = fukangwei
```

注意，设置的环境仅对程序本身有效。你在程序里做的改变不会反映到外部环境中，这是因为变量的值不会从子进程传播到父进程，这样做更安全。本函数在`Linux`下使用仅当前函数有效，应用`setenv`代替。

### setenv

&emsp;&emsp;其函数原型如下：

``` cpp
#include <stdlib.h>
int setenv ( const char *name, const char *value, int overwrite );
```

`setenv`用来改变或增加环境变量的内容，参数`name`为环境变量名称字符串，`value`为变量内容，`overwrite`用来决定是否要改变已存在的环境变量。如果`overwrite`不为`0`，而该环境变量原已有内容，则原内容会被改为参数`value`所指的变量内容；如果`overwrite`为`0`，且该环境变量已有内容，则参数`value`会被忽略。
&emsp;&emsp;对于函数的返回值，执行成功则返回`0`，有错误发生时返回`-1`。错误代码为`ENOMEM`，即内存不足，无法配置新的环境变量空间。

``` cpp
#include <stdlib.h>
#include <stdio.h>
​
int main ( void ) {
    char *p;
​
    if ( ( p = getenv ( "USER" ) ) ) {
        printf ( "USER = %s\n", p );
    }
​
    setenv ( "USER", "test", 1 );
    printf ( "USER = %s\n", getenv ( "USER" ) );
    unsetenv ( "USER" );
    printf ( "USER = %s\n", getenv ( "USER" ) );
}
```

执行结果：

``` cpp
USER = fukangwei
USER = test
USER = (null)
```

### environ

&emsp;&emsp;在`C`语言中有一个全局变量`environ`，用来记录环境变量：

``` cpp
#include <stdlib.h>
extern char **environ;
```

以下程序用于显示所有的环境变量：

``` cpp
#include <stdlib.h>
#include <stdio.h>
​
extern char **environ;
​
int main() {
    char **env = environ;
​
    while ( *env ) {
        printf ( "%s\n", *env );
        env++;
    }
​
    exit ( 0 );
}
```

注意，修改`environ`变量仅对程序本身有效，在程序里改变环境变量不能反映到外部环境中，因为变量不会从子进程(`程序`)传递到父进程(`shell`)。