---
title: IPv6地址格式以及类型
date: 2019-01-17 09:29:00
categories: 网络编程
---
### IPv6地址格式

&emsp;&emsp;`IPv6`的地址长度是`128`位(`bit`)，将这`128`位的地址按每`16`位划分为一个段，将每个段转换成十六进制数字，并用冒号隔开，例如`2000:0000:0000:0000:0001:2345:6789:abcd`。这个地址很长，可以用两种方法对这个地址进行压缩：<!--more-->

- `前导零压缩法`：将每一段的前导零省略，但是每一段都至少应该有一个数字，例如`2000:0:0:0:1:2345:6789:abcd`。
- `双冒号法`：如果一个以冒号十六进制数表示法表示的`IPv6`地址中，如果几个连续的段值都是`0`，那么这些`0`可以简记为`::`。每个地址中只能有一个`::`，例如`2000::1:2345:6789:abcd`。

### 单播地址(Unicast IPv6 Addresses)

- `可聚合的全球单播地址(Aggregatable Global Unicast Addresses)`：可在全球范围内路由和到达的，相当于`IPv4`里面的`global addresses`。前三个`bit`是`001`，例如`2000::1:2345:6789:abcd`。
- `链路本地地址(Link-Local Addresses)`：用于同一个链路上的相邻节点之间通信，相当于`IPv4`里面的`169.254.0.0/16`地址，`IPv6`的路由器不会转发链路本地地址的数据包。前`10`个`bit`是`1111_1110_10`，由于最后是`64 bit`的`interface ID`，所以它的前缀总是`FE80::/64`，例如`FE80::1`。
- `唯一的本地IPv6单播地址(Unique Local IPv6 Unicast Address, ULA)`：在`RFC4193`中标准化了一种用来在本地通信中取代单播站点本地地址的地址。`ULA`拥有固定前缀`FD00::/8`，后面跟一个被称为全局`ID`的`40 bit`随机标识符。

### 未指定地址(Unspecified address)

&emsp;&emsp;其值为`0:0:0:0:0:0:0:0`或者`::`。当一个有效地址还不能确定时，一般用未指定地址作为源地址。未指定地址不能作为一个目标地址来使用。

### 回环地址(Loopback address)

&emsp;&emsp;回环地址`::1`用于标识一个回环接口，可以使一个节点可以给自己发送数据包。相当于`IPv4`的回环地址`127.0.0.1`。

### IPv4映射地址(IPv4-mapped address)

&emsp;&emsp;形如`::FFFF:w.x.y.z`，这里的`w.x.y.z`是`IPv4`公共地址的十进制点号表示法，用于一个仅支持`IPv4`的节点表现为一个`IPv6`的节点。

### 6over4地址

&emsp;&emsp;`64bit-prefix]:0:0:WWXX:YYZZ`，其中的`WWXX:YYZZ`是`w.x.y.z`的`IPv4`公共地址的十进制点号表示法，用于一个使用`6to4`协议的隧道机制的节点。

### 6to4地址

&emsp;&emsp;形如`2002:WWXX:YYZZ:[SLA ID]:[Interface ID]`，用于表示一个使用`6to4`协议的隧道机制节点。

### 多播IPv6地址(Multicast IPv6 Addresses)

&emsp;&emsp;前`8`个`bit`为`1111_1111`，其中`FF01::`到`FF0F::`的多播地址是保留专用地址。

- `FF01::1`：节点本地范围所有节点多播地址。
- `FF02::1`：链路本地范围所有节点多播地址。
- `FF01::2`：节点本地范围所有路由器多播地址。
- `FF02::2`：链路本地范围所有路由器多播地址。
- `FF05::2`：站点本地范围所有路由器多播地址。

---

&emsp;&emsp;`link-local address`中文意思是`链路本地地址`，它的前缀是`FE80::/64`，例如`FE80::713e:a426:d167:37ab`。实际上，这个概念类似于`IPv4`中当`DHCP`分配失败时自动生成的`169.254.XXX.XXX`这样的地址。凡是源地址或目的地址中含有`link-local address`的报文，路由器都不应当转发它，这样的报文只能在一个`LAN`中互通。
&emsp;&emsp;`IPv6`按照传输类型分为单播地址(`unicast`)、任播地址(`anycast`)和多播地址(`multicast`)。
&emsp;&emsp;`单播地址`：单播地址标示一个网络接口，`IPv6`协议会把送往该地址的数据包投送给其接口。`IPv6`的单播地址可以有一个代表特殊地址名字的范畴，如`link-local`地址和唯一区域地址(`Unique Local Address, ULA`)。单播地址包括可聚类的全球单播地址、链路本地地址等。
&emsp;&emsp;`任播地址`：`Anycast`是`IPv6`特有的数据传送方式，它像是`IPv4`的`Unicast单点传播`与`Broadcast多点广播`的综合。`IPv4`支持单点传播和多点广播，单点广播在来源和目的地间直接进行通信；多点广播存在于单一来源和多个目的地进行通信。而`Anycast`则在以上两者之间，它像多点广播一样，会有一组接收节点的地址栏表，但指定为`Anycast`的数据包，只会传送给距离最近或传送成本最低(根据路由表来判断)的其中一个接收地址，当该接收地址收到数据包并进行回应，且加入后续的传输。该接收列表的其他节点，会知道某个节点地址已经回应了，它们就不再加入后续的传输作业。以目前的应用为例，`Anycast`地址只能分配给路由器，不能分配给电脑使用，而且不能作为发送端的地址。
&emsp;&emsp;`多播地址`：多播地址也称组播地址。多播地址也被指定到一群不同的接口，送到多播地址的数据包会被传送到所有的地址。
&emsp;&emsp;`IPv6`中没有子网掩码的概念，也没有网络号与主机号的概念，取而代之的是`前缀长度`和`接口ID`。前缀长度就可以当作子网掩码来理解，接口`ID`可以当作主机号来理解。比如地址`2001:1234:2234:abcd::1/64`就表示前缀长度为`64`位，剩下的是接口`ID`。
&emsp;&emsp;其实`IPv6`的地址空间过于广大，可能一个子网的子网都要比整个`IPv4`的世界要大很多，所以子网的概念在`IPv6`世界里已经淡化了。但是同一站点的主机要想直接通信(不经过路由器)，还是要求前缀相同才行的。

### IPv6多播地址映射位以太网地址

&emsp;&emsp;在以太网链路上发送`IPv6`多播数据包时，对应的`MAC`地址是`0x3333-A-A-A-A`。其中`A-A-A-A`是`IPv6`多播地址的后`32`位的直接映射。对于正在被主机侦听的任何一个多播地址，关注的`MAC`表中会有相应的项。
&emsp;&emsp;例如以太网`MAC`地址为`00-AA-00-3F-2A-1C`(链路本地地址`FE80::2AA:FF:FE3F:2A1C`)的主机，会把以下多播`MAC`地址添加到它的以太网卡的关注的目标`MAC`地址表中：

- 地址`33-33-00-00-00-01`对应于链路本地范围所有节点多播地址`FF02::1`。
- 地址`33-33-FF-3F-2A-1C`对应于请求节点地址`FF02::1:FF3F:2A1C`。请求节点地址是由前缀`FF02::1:FF00:0/104`和单播`IPv6`地址的后`24`位构成。