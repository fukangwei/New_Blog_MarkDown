---
title: 51单片机使用注意
categories: 51单片机
date: 2018-12-29 18:57:12
---
1. 定时器中断的时间不要设定得太短，比如`100us`会使系统不稳定(在中断函数还没有处理完时，又产生新的中断)。<!--more-->
2. 定时器中断最好用单片机小精灵计算。
3. 由于`51`单片机的内存限制，数据不要出现溢出(`char`为`8`位，`int`为`16`位)。
4. 拿到新程序时，必须要注意引脚绑定。
5. 内存复制要用`memcpy`或`strcpy`。
6. 大的数组不要放在函数中当做局部变量，尽量当做全局变量或者静态变量，否则会出现程序跑飞现象。
7. 在调试无线模块时，要进行双向测试，即双方都要进行收发测试。
8. 定时器的方式`0`或方式`1`有可能定时不准确，需要测试。`51`单片机定时器`0`的方式`1`比方式`2`好用。
9. 有些串口模块不能接收，这一点要注意。串口的发送和接收要看串口上`LED`灯的闪烁情况。
10. `Si4432`的发送和接收要延迟一定的时间。
11. `STC12C5A60S2`用单片机小精灵计算延时要选择`STC1T`模式。
12. 串口在全双工的工作模式下，发送和接收互不影响。
13. `51`单片机的`printf`函数并不实用，最好要自己写出打印函数。`51`单片机的`printf`函数一旦参数超过三个时，有可能出错。
14. `STC12C5A60S2`的`P0`口不需要上拉电阻，内部已经有了，但最好外接上拉电阻(在调试`W5500`时发现问题)。要多注意芯片数据手册，尤其是关于单片机引脚的部分。
15. 继电器在关闭的时候会产生一个大电流，加大电容即可解决，注意电容对电路的影响(`霍中兴`总结的)。
16. 如果需要使用`_nop_`函数，则要添加头文件`intrins.h`。该函数相当汇编`NOP`指令(单周期指令)，对于`12MHz`晶振，延时为`1us`。
17. `1T`和`12T`单片机编程需要注意：定时器部分不用改，`1T`单片机的定时器兼容传统的`12T`单片机，只是如果用到软件延时的话，就要修改延时函数。
18. 在`keil C51`中，左移或右移有可能失效，需要用乘法或者除法。在程序设计中，一定要考虑左移、右移操作对寄存器以及变量中数据的影响。
19. 注意`C`语言运算符的优先级，如左移和加号的优先级。
20. 注意单片机的供电问题。当单片机出现代码不能下载的问题时，可以尝试对单片机进行额外供电，然后使用串口模块对其下载代码。
21. `NRF24L01`只能发送一次的原因是没有写`STATUS`为`0XFF`，写一下就好了。
22. 舵机有`调速电机`与`调角度电机`之分。`180`度舵机转的角度不是每次控制都要转的角度，而是以某一个轴为参考固定的角度。
23. `DS18B20`温度传感器在刚上电时会显示`85`摄氏度，这是其上电复位后温度寄存器内对应的数字量。
24. `51`单片机程序的下载线不要用细的数据线，最好用带双磁环的数据线。
25. 使用`51`单片机模拟`PWM`时，只有`P3^0`与`P3^1`是有效的，原因不明。
26. 在进行`UDP`模式的调试时，一定不要忘记加上另一端的`IP`地址和其端口号。
27. 使用逻辑分析仪时，一定要让逻辑分析仪与单片机接公共地。
28. 在`51`单片机中，打开了定时器中断，就一定要加上定时器中断函数，否则程序就会跑飞。`51`单片机如果设置了中断，就一定要写中断处理函数，无论是外部中断、串口中断，还是定时器中断。
29. `51`单片机可以同时使用定时器`0`与定时器`1`，只不过要注意`TMOD`的设置。
30. 在程序中，如果需要用到并行处理的话，可以考虑用中断或定时器中断。
31. 在`C`语言中，`unsigned`不能用于修饰`float`和`double`，因为`float`和`double`总是带符号的。
32. `51`单片机采用`11.0592MHz`晶振是为了提供标准的串口波特率。`11.0592MHz`在串口通信时比较容易分频成常见的波特率：`11.0592MHz = 192*57600 = 384*28800 = 576*19200 = 1152*9600`。如果想要得到标准的时钟频率，还是要用`12MHz`晶振。
33. 在使用`LCD5110`时，一定要注意它的四个卡口是否与焊盘接触良好。如果接触良好并且通过驱动测试，可以把卡口与焊盘焊接起来。
34. 在单片机中，外部中断、串口中断和定时器中断是与主函数(`main`)代码并行执行的，它们之间可能会互相影响，因此要仔细分析。
35. 单片机输出低电平时，允许外部器件向单片机引脚内灌入电流，这个电流称为`灌电流`；输出高电平时，则允许外部器件从单片机的引脚拉出电流，这个电流称为`拉电流`。单片机输出低电平的时候，驱动能力尚可；而输出高电平的时候，就没有输出电流的能力。设计单片机的负载电路，应该采用`灌电流负载`的电路形式，以避免无谓的电流消耗。
36. 在源文件中，一定要注意`l`和`1`、`o`和`0`的字符区别。
37. `Keil`中地址是自动分配的，所以除非特殊情况，否则不提倡使用绝对地址定位(使用`_at_`关键字)。
38. 在程序设计中，尽量不要采用计数的方式接收数据，这会导致代码的健壮性很弱。常用的方法是根据数据的末尾信息进行对数据的接收与截断，如换行符的`0x0D`和`0x0A`信息。
39. 将`Keil`软件中源文件注释的字体改为中文的方法：`Configuration` -> `Editor` -> `Encoding` -> `Chinese GB2312(Simplified)`。
40. `fosc`即`frequency oscillate`，就是晶振频率。`xosc`是指外部的晶振给系统提供`clock`，`rcosc`是指单片机内部的`RC`震荡电路提供系统`clock`。
41. 旋转编码器`lpd3806-400bm-g5-24c`的使用方法：外径为`38`，轴为`6`，`400`脉冲，开路输出，共有`5`根线。标牌上应该有接线表，正常接线就可以了。
42. 注意`Keil C51`编译器的关键词，`data`是其中之一。在编程中，一定不要让变量名和关键词重名。
43. `51`单片机的所有输入/输出端口上电默认状态都是高电平，在设计电路时一定要注意，尤其是在设计控制电路的时候。
44. 对于继电器电路的设计，使用`NPN`或是`PNP`进行控制，则将继电器放在`c`极。一定不要将`NPN`和`PNP`的`e`极和`c`极搞混。
45. `51`单片机使用类似`printf`的函数时，`%x`是按照`int`类型进行取值，要将数据进行强制转换。
46. `51`单片机同时使用串口与定时器的方法为：串口所用的定时器与定时用的定时器不冲突；将其中一个`TMOD =`改为`TMOD |=`。
47. 数码管共阳级编码为`0xc0, 0xf9, 0xa4, 0xb0, 0x99, 0x92, 0x82, 0xf8, 0x80, 0x90, 0x88, 0x83, 0xc6, 0xa1, 0x86, 0x8e`，共阴级编码为`0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d, 0x07, 0x7f, 0x6f, 0x77, 0x7c, 0x39, 0x5e, 0x79, 0x71`。
48. `Keil`添加`STC`单片机的方法：在`Keil/C51/INC`下新建`STC`文件夹，把`STC`单片机的头文件拷贝到该目录下。将下载的`STC`器件数据库更名为`STC.CDB`，并拷贝到`Keil/UV2`目录下(如果是`Keil4`，则为`UV4`)。打开`Keil`目录下的`TOOLS.ini`，在`[UV2]`下面(也就是`[C51]`上面)输入`CDB0=UV2\STC.CDB("STC")`，然后保存(如果是`Keil4`，则为`UV4`)。
49. `STC12C5A60S2`的`P4.4`、`P4.5`和`P4.6`作为`IO`口使用，需要在程序中加入`P4SW = 0x70;`。